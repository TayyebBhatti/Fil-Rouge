{% extends "base.html.twig" %}
{% block title %}Accueil
{% endblock %}

{% block stylesheets %}
	<style>:root
	{
		--bg: #f6f8fb;
		--card: #fff;
		--text: #111827;
		--muted: #6b7280;
		--primary: #0ea5e9;
		--primary-hover: #0369a1;
		--success: #16a34a;
		--success-hover: #15803d;
		--danger: #dc2626;
		--danger-hover: #b91c1c;
		--border: #e5e7eb;
		--shadow: 0 8px 24px rgba(0, 0, 0, .08)
	}
	* {
		box-sizing: border-box
	}
	body {
		margin: 0;
		font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
		background: var(--bg);
		color: var(--text)
	}
	.wrap {
		max-width: 1100px;
		margin: 24px auto;
		padding: 0 16px
	}

	/* Alerts */
	.alert {
		padding: 10px 12px;
		border: 1px solid;
		border-radius: 10px;
		margin-bottom: 10px;
		font-size: 14px
	}
	.alert-success {
		border-color: var(--success);
		color: #14532d;
		background: #ecfdf5
	}
	.alert-error {
		border-color: var(--danger);
		color: #7f1d1d;
		background: #fef2f2
	}

	/* Header */
	.head {
		display: flex;
		justify-content: space-between;
		align-items: center;
		gap: 12px;
		margin-bottom: 20px
	}
	h1 {
		margin: 0
	}

	.btn {
		display: inline-block;
		padding: 10px 16px;
		border-radius: 10px;
		border: 1px solid transparent;
		font-weight: 600;
		text-decoration: none;
		cursor: pointer
	}
	.btn-primary {
		background: var(--success);
		border-color: var(--success);
		color: #fff
	}
	.btn-primary:hover {
		background: var(--success-hover)
	}
	.btn-info {
		background: var(--primary);
		border-color: var(--primary);
		color: #fff
	}
	.btn-info:hover {
		background: var(--primary-hover)
	}
	.btn-ghost {
		background: #fff;
		border-color: #cbd5e1;
		color: #0b1220
	}
	.btn-ghost:hover {
		border-color: #94a3b8
	}
	.btn-danger {
		background: var(--danger);
		border-color: var(--danger);
		color: #fff
	}
	.btn-danger:hover {
		background: var(--danger-hover)
	}

	.filter {
		background: #f9fafb;
		border: 1px solid var(--border);
		border-radius: 14px;
		padding: 16px;
		box-shadow: var(--shadow);
		margin-bottom: 18px
	}
	.grid {
		display: grid;
		gap: 14px
	}
	.grid-auto {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
		gap: 14px
	}
	label {
		display: block;
		font-size: 14px;
		margin: 0 0 6px;
		color: var(--muted)
	}
	input[type="text"],
	input[type="date"],
	select {
		width: 100%;
		padding: 10px 12px;
		border: 1px solid var(--border);
		border-radius: 10px;
		background: #fff;
		font-size: 14px
	}
	input:focus,
	select:focus {
		outline: none;
		border-color: var(--primary);
		box-shadow: 0 0 0 3px rgba(14, 165, 233, .15)
	}
	.filter-actions {
		display: flex;
		gap: 10px;
		flex-wrap: wrap
	}

	.count {
		margin-bottom: 12px;
		color: var(--muted);
		font-style: italic
	}

	.cards {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
		gap: 18px
	}
	.card {
		border: 1px solid var(--border);
		border-radius: 14px;
		overflow: hidden;
		background: #fff;
		box-shadow: 0 4px 16px rgba(0, 0, 0, .06)
	}
	.card img {
		width: 100%;
		height: 180px;
		object-fit: cover
	}
	.card-body {
		padding: 12px
	}
	.card h2 {
		margin: 4px 0 6px;
		font-size: 1.15rem
	}
	.meta {
		margin: 0;
		color: #555
	}
	.place {
		margin: 4px 0;
		color: #444
	}
	.cat {
		margin: 4px 0;
		color: #666
	}
	.desc {
		margin-top: 6px;
		color: #333
	}
	.insc {
		margin: 6px 0;
		color: #333
	}
	.actions {
		display: flex;
		gap: 8px;
		margin-top: 10px
	}
	.w-100 {
		width: 100%;
		text-align: center
	}
</style>{% endblock %}{% block body %}
<div
	class="wrap">

	{% for msg in app.flashes('success') %}
		<div class="alert alert-success">{{ msg }}</div>
	{% endfor %}
	{% for msg in app.flashes('error') %}
		<div class="alert alert-error">{{ msg }}</div>
	{% endfor %}

	<div class="head">
		<h1>√âv√©nements</h1>
		{% if app.user and 'ROLE_ADMIN' in app.user.roles %}
			<a href="{{ path('admin_evenement_index') }}" class="btn btn-primary">Ajouter √©v√©nements</a>
		{% endif %}
	</div>

	<div class="filter">
		<form method="get" action="{{ path('default_home') }}">
			<div class="grid">
				<div>
					<label for="search">üîç Recherche</label>
					<input id="search" name="search" type="text" value="{{ currentSearch }}" placeholder="Titre, description, ville ou pays">
				</div>

				<div class="grid-auto">
					<div>
						<label for="categorie">üè∑Ô∏è Cat√©gorie</label>
						<select id="categorie" name="categorie">
							<option value="">Toutes les cat√©gories</option>
							{% for cat in categories %}
								<option value="{{ cat.id }}" {% if currentCategorie == cat.id %} selected {% endif %}>{{ cat.nom }}</option>
							{% endfor %}
						</select>
					</div>

					<div>
						<label for="date_debut">üìÖ √Ä partir du</label>
						<input id="date_debut" name="date_debut" type="date" value="{{ currentDateDebut }}">
					</div>

					<div>
						<label for="date_fin">üìÖ Jusqu'au</label>
						<input id="date_fin" name="date_fin" type="date" value="{{ currentDateFin }}">
					</div>
				</div>

				<div class="filter-actions">
					<button type="submit" class="btn btn-info">üîé Rechercher</button>
					<a href="{{ path('default_home') }}" class="btn btn-ghost">‚úñÔ∏è R√©initialiser</a>
				</div>
			</div>
		</form>
	</div>

	{% if currentSearch or currentCategorie or currentDateDebut or currentDateFin %}
		<p class="count">{{ evenements|length }}
			r√©sultat(s) trouv√©(s)</p>
	{% endif %}

	{% if evenements is empty %}
		<div class="card" style="text-align:center;">
			<div class="card-body">
				<p class="meta" style="font-size:1.05rem;">Aucun √©v√©nement trouv√©.</p>
				{% if currentSearch or currentCategorie or currentDateDebut or currentDateFin %}
					<a href="{{ path('default_home') }}" class="btn btn-ghost" style="margin-top:8px;">Voir tous les √©v√©nements</a>
				{% endif %}
			</div>
		</div>

	{% else %}
		<div class="cards">
			{% for e in evenements %}
				{% set nbInsc = e.inscriptions is defined ? e.inscriptions|length : 0 %}
				{% set isRegistered = app.user and (e.id in registeredEventIds) %}

				<article class="card">
					{% if e.image %}
						<img src="{{ asset(e.image) }}" alt="Image de {{ e.titre }}">
					{% else %}
						<img src="{{ asset('img/default.jpg') }}" alt="Image par d√©faut">
					{% endif %}

					<div class="card-body">
						<h2>{{ e.titre ?? ('√âv√©nement #' ~ e.id) }}</h2>

						<p class="meta">
							{{ e.dateDebut ? e.dateDebut|date('d/m/Y H:i') : 'Date √† venir' }}
							{% if e.dateFin %}
								‚Üí
								{{ e.dateFin|date('d/m/Y H:i') }}
							{% endif %}
						</p>

						{% if e.lieu %}
							<p class="place">
								üìç
								{% if e.lieu.rue is defined and e.lieu.rue %}
									{{ e.lieu.rue }},
								{% endif %}
								{% if e.lieu.code_postal is defined and e.lieu.code_postal %}
									{{ e.lieu.code_postal }}
								{% endif %}
								{% if e.lieu.ville is defined and e.lieu.ville %}
									{{ e.lieu.ville }}
								{% endif %}
								{% if e.lieu.pays is defined and e.lieu.pays %}
									‚Ä¢
									{{ e.lieu.pays }}
								{% endif %}
							</p>
						{% endif %}

						{% if e.categorie %}
							<p class="cat">üè∑Ô∏è
								{{ e.categorie.nom ?? e.categorie }}</p>
						{% endif %}

						{% if e.description %}
							<p class="desc">{{ e.description|u.truncate(120, '‚Ä¶', false) }}</p>
						{% endif %}

						<p class="insc">
							{% if e.capaciteMax is defined %}
								{{ nbInsc }}/{{ e.capaciteMax }}
								inscrits
							{% else %}
								{{ nbInsc }}
								inscrit(s)
							{% endif %}
						</p>

						<div class="actions">
							<a href="{{ path('evenement_show', {id: e.id}) }}" class="btn btn-ghost w-100">D√©tails</a>

							{% if app.user %}
								{% if isRegistered %}
									<form method="post" action="{{ path('evenement_unregister', {id: e.id}) }}" class="w-100">
										<input type="hidden" name="_token" value="{{ csrf_token('desinscrire_' ~ e.id) }}">
										<button type="submit" class="btn btn-danger w-100">Se d√©sinscrire</button>
									</form>
								{% else %}
									<form method="post" action="{{ path('evenement_register', {id: e.id}) }}" class="w-100">
										<input type="hidden" name="_token" value="{{ csrf_token('inscrire_' ~ e.id) }}">
										<button type="submit" class="btn btn-primary w-100">S'inscrire</button>
									</form>
								{% endif %}
							{% else %}
								<a href="{{ path('default_login') }}" class="btn btn-info w-100">Se connecter</a>
							{% endif %}
						</div>
					</div>
				</article>
			{% endfor %}
		</div>
	{% endif %}

</div>{% endblock %}
