{% extends "base.html.twig" %}
{% block title %}Détails de l’événement{% endblock %}

{% block body %}
    <div class="page-container">
        {% for msg in app.flashes('success') %}
            <div class="flash flash--success">{{ msg }}</div>
        {% endfor %}
        {% for msg in app.flashes('error') %}
            <div class="flash flash--error">{{ msg }}</div>
        {% endfor %}

        <article class="card card--no-padding">
            {% if evenement.image %}
                <img class="event-cover" src="{{ asset(evenement.image) }}" alt="Image de {{ evenement.titre }}">
            {% else %}
                <img class="event-cover" src="{{ asset('img/default.jpg') }}" alt="Image par défaut">
            {% endif %}

            <div class="event-detail">
                <div class="card-header event-detail__header">
                    <h1 class="event-detail__title">{{ evenement.titre ?? ('Événement #' ~ evenement.id) }}</h1>
                    <a class="btn btn-ghost" href="{{ path('default_home') }}">← Retour</a>
                </div>

                <div class="event-meta">
                    <span>📅 Du {{ evenement.dateDebut ? evenement.dateDebut|date('d/m/Y H:i') : 'Date à venir' }}{% if evenement.dateFin %} au {{ evenement.dateFin|date('d/m/Y H:i') }}{% endif %}</span>

                    {% if createur %}
                        <span>👤 Créé par :
                            <strong>
                                {% if createur.prenom is defined %}{{ createur.prenom }} {% endif %}
                                {% if createur.nom is defined %}{{ createur.nom }}{% endif %}
                            </strong>
                        </span>
                    {% endif %}

                    {% if evenement.lieu %}
                        <span>
                            📍
                            {% if evenement.lieu.rue is defined and evenement.lieu.rue %}{{ evenement.lieu.rue }}, {% endif %}
                            {% if evenement.lieu.code_postal is defined and evenement.lieu.code_postal %}{{ evenement.lieu.code_postal }} {% endif %}
                            {% if evenement.lieu.ville is defined and evenement.lieu.ville %}{{ evenement.lieu.ville }}{% endif %}
                            {% if evenement.lieu.pays is defined and evenement.lieu.pays %} • {{ evenement.lieu.pays }}{% endif %}
                        </span>
                    {% endif %}

                    {% if evenement.categorie %}
                        <span>🏷️ Catégorie : {{ evenement.categorie.nom ?? evenement.categorie }}</span>
                    {% endif %}
                </div>

                {% if evenement.description %}
                    <div class="content-box">
                        <p>{{ evenement.description }}</p>
                    </div>
                {% endif %}

                {% set nbInsc = evenement.inscriptions is defined ? evenement.inscriptions|length : 0 %}
                {% if evenement.capaciteMax is defined %}
                    <span class="badge badge-info badge-align-start">👥 {{ nbInsc }}/{{ evenement.capaciteMax }} inscrit(s)</span>
                {% endif %}

                <div class="form-actions">
                    {% if app.user %}
                        {% if dejaInscrit %}
                            <form method="post" action="{{ path('evenement_unregister', {id: evenement.id}) }}">
                                <input type="hidden" name="_token" value="{{ csrf_token('desinscrire_' ~ evenement.id) }}">
                                <button class="btn btn-danger" type="submit">Se désinscrire</button>
                            </form>
                        {% else %}
                            <form method="post" action="{{ path('evenement_register', {id: evenement.id}) }}">
                                <input type="hidden" name="_token" value="{{ csrf_token('inscrire_' ~ evenement.id) }}">
                                <button class="btn btn-success" type="submit">S’inscrire</button>
                            </form>
                        {% endif %}
                    {% else %}
                        <a class="btn btn-primary" href="{{ path('default_login') }}">Se connecter pour s’inscrire</a>
                    {% endif %}
                </div>
            </div>
        </article>
    </div>
{% endblock %}
